{% load staticfiles %}
<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		{% block title %}
		<title>控制台 - Bootstrap后台管理系统模版Ace下载</title>
        {% endblock %}
		<meta name="keywords" content="Bootstrap模版,Bootstrap模版下载,Bootstrap教程,Bootstrap中文" />
		<meta name="description" content="站长素材提供Bootstrap模版,Bootstrap教程,Bootstrap中文翻译等相关Bootstrap插件下载" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<!-- basic styles -->
		<link rel="stylesheet" href={% static "css/bootstrap.min.css" %} />
		<link rel="stylesheet" href={% static "css/font-awesome.min.css" %} />
		<link rel="stylesheet" href={% static "css/ace.min.css" %} />
		<link rel="stylesheet" href={% static "css/mycss.css" %} />
	</head>

	<body>
        <div class="widget-box-overlay" style="display: none">
            <span class="overlay-loading">添加中，请稍后......</span>
        </div>
		<div class="navbar navbar-default" id="navbar">
			<script type="text/javascript">
				try{ace.settings.check('navbar' , 'fixed')}catch(e){}
			</script>
			<div class="navbar-container" id="navbar-container">
				<div class="navbar-header pull-left">
					<a href="#" class="navbar-brand">
						<small>
							<i class="icon-leaf"></i>
							ACE后台管理系统
						</small>
					</a><!-- /.brand -->
				</div><!-- /.navbar-header -->

				<div class="navbar-header pull-right" role="navigation">
					<ul class="nav ace-nav">
						<li class="light-blue">
							<a data-toggle="dropdown" href="#" class="dropdown-toggle">
								<span class="user-info">
									<small>欢迎,</small>
									{{  request.user }}
								</span>
								<i class="icon-caret-down"></i>
							</a>

							<ul class="user-menu pull-right dropdown-menu dropdown-yellow dropdown-caret dropdown-close">
{#								<li>#}
{#									<a href="#">#}
{#										<i class="icon-cog"></i>#}
{#										设置#}
{#									</a>#}
{#								</li>#}
{##}
{#								<li>#}
{#									<a href="#">#}
{#										<i class="icon-user"></i>#}
{#										个人资料#}
{#									</a>#}
{#								</li>#}
{##}
{#								<li class="divider"></li>#}

								<li>
									<a href="/logout/">
										<i class="icon-off"></i>
										退出
									</a>
								</li>
							</ul>
						</li>
					</ul><!-- /.ace-nav -->
				</div><!-- /.navbar-header -->
			</div><!-- /.container -->
		</div>

		<div class="main-container" id="main-container">
			<script type="text/javascript">
				try{ace.settings.check('main-container' , 'fixed')}catch(e){}
			</script>

			<div class="main-container-inner">
				<a class="menu-toggler" id="menu-toggler" href="#">
					<span class="menu-text"></span>
				</a>

				<div class="sidebar" id="sidebar">
					<script type="text/javascript">
						try{ace.settings.check('sidebar' , 'fixed')}catch(e){}
					</script>

					<!--<div class="sidebar-shortcuts" id="sidebar-shortcuts">-->
						<!--<div class="sidebar-shortcuts-large" id="sidebar-shortcuts-large">-->
							<!--<button class="btn btn-success">-->
								<!--<i class="icon-signal"></i>-->
							<!--</button>-->

							<!--<button class="btn btn-info">-->
								<!--<i class="icon-pencil"></i>-->
							<!--</button>-->

							<!--<button class="btn btn-warning">-->
								<!--<i class="icon-group"></i>-->
							<!--</button>-->

							<!--<button class="btn btn-danger">-->
								<!--<i class="icon-cogs"></i>-->
							<!--</button>-->
						<!--</div>-->

						<!--<div class="sidebar-shortcuts-mini" id="sidebar-shortcuts-mini">-->
							<!--<span class="btn btn-success"></span>-->

							<!--<span class="btn btn-info"></span>-->

							<!--<span class="btn btn-warning"></span>-->

							<!--<span class="btn btn-danger"></span>-->
						<!--</div>-->
					<!--</div>&lt;!&ndash; #sidebar-shortcuts &ndash;&gt;-->
					<ul class="nav nav-list">
						<li {% if request.path == '/' %} class="active" {% endif %}>
							<a href="/">
								<i class="icon-dashboard"></i>
								<span class="menu-text"> 控制台 </span>
							</a>
						</li>

                        <li {% if request.path|slice:'10' == '/container' %} class="active" {% endif %}>
							<a href="/container/">
								<i class="icon-hdd"></i>
								<span class="menu-text"> 容器列表 </span>
							</a>
						</li>

                        <li {% if request.path|slice:'6' == '/image' %} class="active" {% endif %}>
							<a href="/image/">
								<i class="icon-cloud"></i>
								<span class="menu-text"> 镜像列表 </span>
							</a>
						</li>

                        <li {% if request.path|slice:'5' == '/host' %} class="active" {% endif %}>
							<a href="/host/">
								<i class="icon-desktop"></i>
								<span class="menu-text"> 宿主机列表 </span>
							</a>
						</li>
					</ul><!-- /.nav-list -->

				</div>

				<div class="main-content">
					<div class="breadcrumbs" id="breadcrumbs">
						<script type="text/javascript">
							try{ace.settings.check('breadcrumbs' , 'fixed')}catch(e){}
						</script>
                        {% block breadcrumbs %}
						<ul class="breadcrumb">
							<li>
								<i class="icon-home home-icon"></i>
								<a href="#">首页</a>
							</li>
							<li class="active">控制台</li>
						</ul><!-- .breadcrumb -->

						<div class="nav-search" id="nav-search">
							<form class="form-search">
								<span class="input-icon">
									<input type="text" placeholder="Search ..." class="nav-search-input" id="nav-search-input" autocomplete="off" />
									<i class="icon-search nav-search-icon"></i>
								</span>
							</form>
						</div><!-- #nav-search -->
                        {% endblock %}
					</div>

					{% block page-content %}
					<div class="space-12"></div>
                        <div class="col-sm-12 infobox-container">
                            <div class="infobox infobox-green  ">
                                <div class="infobox-icon">
                                    <i class="icon-comments"></i>
                                </div>

                                <div class="infobox-data">
                                    <span class="infobox-data-number">32</span>
                                    <div class="infobox-content">2个评论</div>
                                </div>
                                <div class="stat stat-success">8%</div>
                            </div>

                            <div class="infobox infobox-blue  ">
                                <div class="infobox-icon">
                                    <i class="icon-twitter"></i>
                                </div>

                                <div class="infobox-data">
                                    <span class="infobox-data-number">11</span>
                                    <div class="infobox-content">新粉丝</div>
                                </div>

                                <div class="badge badge-success">
                                    +32%
                                    <i class="icon-arrow-up"></i>
                                </div>
                            </div>

                            <div class="infobox infobox-pink  ">
                                <div class="infobox-icon">
                                    <i class="icon-shopping-cart"></i>
                                </div>

                                <div class="infobox-data">
                                    <span class="infobox-data-number">8</span>
                                    <div class="infobox-content">新订单</div>
                                </div>
                                <div class="stat stat-important">4%</div>
                            </div>

                            <div class="infobox infobox-red  ">
                                <div class="infobox-icon">
                                    <i class="icon-beaker"></i>
                                </div>

                                <div class="infobox-data">
                                    <span class="infobox-data-number">7</span>
                                    <div class="infobox-content">调查</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-12 infobox-container">
                            <div class="infobox infobox-orange2  ">
                                <div class="infobox-chart">
                                    <span class="sparkline" data-values="196,128,202,177,154,94,100,170,224"></span>
                                </div>

                                <div class="infobox-data">
                                    <span class="infobox-data-number">6,251</span>
                                    <div class="infobox-content">页面查看次数</div>
                                </div>

                                <div class="badge badge-success">
                                    7.2%
                                    <i class="icon-arrow-up"></i>
                                </div>
                            </div>

                            <div class="infobox infobox-blue2  ">
                                <div class="infobox-progress">
                                    <div class="easy-pie-chart percentage" data-percent="42" data-size="46">
                                        <span class="percent">42</span>%
                                    </div>
                                </div>

                                <div class="infobox-data">
                                    <span class="infobox-text">交易使用</span>

                                    <div class="infobox-content">
                                        <span class="bigger-110">~</span>
                                        剩余58GB
                                    </div>
                                </div>
                            </div>
                        </div>
					{% endblock %}
				</div><!-- /.main-content -->
			</div><!-- /.main-container-inner -->
		</div><!-- /.main-container -->
		<!-- basic scripts -->


        <script src={% static "js/jquery-2.0.3.min.js" %}></script>

		<script src={% static "js/bootstrap.min.js" %}></script>

		<!-- page specific plugin scripts -->
		<script src={% static "js/jquery-ui-1.10.3.custom.min.js" %}></script>
        <script src={% static "js/jquery-2.0.3.min.js" %}></script>
		<script src={% static "js/jquery.cookie.min.js" %}></script>
		<script src={% static "js/ace.min.js" %}></script>

    {% block custom_js %}
    {% endblock %}
    <script>
        // 检测添加宿主机的状态
        $("#chkhost").click(function(e){
            console.log('chkhost');
            var ip=$("#ip").val();
            var port=$("#port").val();
            console.log(ip, port);
            $("#chkhost").text('检测中,请稍后...');
            $.ajax({
                url: "/chkhost/",
                type: "post",
                data: {"ip":ip, "port":port},
                headers: {"X-CSRFtoken": $.cookie("csrftoken")},
                success: function(version){
                    console.log('version');
                    if (version=='error'){
                        $("#chkhost").text(version);
                        $("#addhost").attr('disabled', true);
                    }
                    else{
                        $("#chkhost").text(version);
                        $("#addhost").attr('disabled', false);
                    }
                }
            })
        })

        // 添加宿主机
        $("#addhost").click(function () {
            $("#hostform").submit();
        })

        //判断添加宿主机的结果，成功则返回宿主机列表。
        $(function () {
            if ($("#addresult").text()=='success'){
                $(".alert-success").show();
                window.location.href='/host/';
                $("#addresult").text('');

            }
            else if ($("#addresult").text()=='error') {
                $(".alert-danger").show();
                $("#addresult").text('');
            }
        })

        // 启动、停止、重启容器
        $(function () {
            $(".action-buttons a i").click(function () {
                var todo=$(this).attr('todo');
                var host=$(this).attr('host');
                var container_id=$(this).attr('container_id');
                if (todo=='start'){
                    $.ajax({
                        url: "/container/start/"+host+"/"+container_id+"/",
                        type: "post",
                        headers:{ "X-CSRFtoken":$.cookie("csrftoken")},
                        success: function (start_status) {
                            if (start_status=='running'){
                                $(".alert-success").show();
                                window.location.href='/container/';
                            }
                            else{
                                $(".alert-danger").show();
                            }
                        }
                    });
                }
                else if (todo=='stop'){
                    $.ajax({
                        url: "/container/stop/"+host+"/"+container_id+"/",
                        type: "post",
                        headers:{ "X-CSRFtoken":$.cookie("csrftoken")},
                        success: function (stop_status) {
                            if (stop_status!='running'){
                                $(".alert-success").show();
                                window.location.href='/container/';
                            }
                            else{
                                $(".alert-danger").show();
                            }
                        }
                    });
                }
                else if(todo=='restart'){
                    $.ajax({
                        url: "/container/restart/"+host+"/"+container_id+"/",
                        type: "post",
                        headers:{ "X-CSRFtoken":$.cookie("csrftoken")},
                        success: function (restart_status) {
                            if (restart_status=='running'){
                                $(".alert-success").show();
                                window.location.href='/container/';
                            }
                            else{
                                $(".alert-danger").show();
                            }
                        }
                    });
                };
            })
        })

        // 删除容器
        $(function () {
            $(".btn-group ul li a").click(function () {
                console.log($(this).text());
                var todo=$(this).attr('todo');
                var host=$(this).attr('host');
                var container_id=$(this).attr('container_id');
                if (todo=='delete'){
                    $.ajax({
                        url: '/container/delete/'+host+"/"+container_id+"/",
                        type: 'post',
                        headers:{ "X-CSRFtoken":$.cookie("csrftoken")},
                        success: function (delete_status) {
                            if (delete_status=='success'){
                                $('.alert-success').show();
                                window.location.href='/container/';
                            }
                            else {
                                $('.alert-danger').show();
                            }
                        }
                    })
                }
            })
        })

        // 创建容器选择宿主机后获取宿主机包含的镜像
        function getimage(e) {
            var selected = $("#form-field-select-1").val();
            console.log(selected);
            $.ajax({
                url: '{% url 'containerimage' %}',
                type: 'post',
                data: {'selected': selected},
                headers:{ "X-CSRFtoken":$.cookie("csrftoken")},
                success: function (image) {
                    $("#form-field-select-2 option").remove('option[value!=""]');
                    for (var i=0,l=image.length; i<l; i++){
                        var new_option = '<option value="'+image[i]+'">'+image[i]+'</option>';
                        console.log(image[i])
                        $("#form-field-select-2").append(new_option)
                    }
                }
            })
        }

        // 创建容器的分步对话框
        $(function () {
            $(".btn-next").click(function () {
                step_status = $(".wizard-steps li[data-target='#modal-step4']").attr('class');
                if (step_status == 'active') {
                    var flag = $("#flag").text();
                    if(flag==1) {
                        var name = $("#inputInfo11").val();
                        var image = $("#form-field-select-1").val();
                        var host = $("#form-field-select-2").val();
                        var hostname = $("#inputInfo12").val();
                        var address = $("#inputInfo21").val();
                        var gateway = $("#inputInfo22").val();
                        var netmask = $("#inputInfo23").val();
                        var dns = $("#inputInfo24").val();
                        var other = $("#form-field-1").val();
                        var after = $("#form-field-2").val();
                        var info_left = {
                            'name': name, 'image': image,
                            'host': host, 'hostname': hostname,
                            'address': address, 'gateway': gateway,
                            'netmask': netmask, 'dns': dns
                        };
                        var info_right = {'other': other, 'after': after};

                        for (var i in info_left) {
                            var info = "<li>" + i + ": " + info_left[i] + "</li>"
                            $("#all-info-left ul").append(info)
                        }

                        for (var j in info_right) {
                            var info = "<li>" + j + ": " + info_right[j] + "</li>"
                            $("#all-info-right ul").append(info)
                        }
                        $("#flag").text(0);
                    }
                    $(".btn-next").hide();
                    $(".btn-submit").show();
                }
            })

            $(".btn-submit").click(function () {
                console.log('submit');
                var name = $("#inputInfo11").val();
                var host = $("#form-field-select-1").val();
                var image = $("#form-field-select-2").val();
                var hostname = $("#inputInfo12").val();
                var address = $("#inputInfo21").val();
                var gateway = $("#inputInfo22").val();
                var netmask = $("#inputInfo23").val();
                var dns = $("#inputInfo24").val();
                var other = $("#form-field-1").val();
                var after = $("#form-field-2").val();
                var info = {'name': name, 'host': host,
                            'image': image, 'hostname': hostname,
                            'address': address, 'gateway': gateway,
                            'netmask': netmask, 'dns': dns,
                            'other': other, 'after': after
                            };
                $("#modal-wizard").hide();
                $(".modal-backdrop").hide();
                $(".widget-box-overlay").show();
                $.ajax({
                    url: '{% url 'addcontainer' %}',
                    type: 'post',
                    data: info,
                    dataType: 'application/json',
                    headers: {'X-CSRFtoken': $.cookie('csrftoken')},
                })
            })

            $(".btn-prev").click(function () {
                $("#all-info-left ul li").remove('li');
                $("#all-info-right ul li").remove('li');
                $(".wizard-steps li[data-target='#modal-step4']").attr('class', '');
                $("#flag").text(1);
                $(".btn-next").show();
                $(".btn-submit").hide();
            })
        })
    </script>
</body>
</html>

